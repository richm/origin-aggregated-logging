<filter project.**>
  @type record_transformer
  enable_ruby

  <record>
    # pat = '^k8s_(?<container_name>[^\.]+)\.[^_]+_(?<pod_name>[^_]+)_(?<namespace>[^_]+)_[^_]+_[a-f0-9]{8}$'
    # The <namespace> is used for the index name: project.<namespace>.38b301f1-fa1a-11e6-9eab-0e6d4afce750.2017.02.23
    # The rest of CONTAINER_NAME and _ID are just to match the pattern.
	CONTAINER_NAME ${record.fetch('CONTAINER_NAME', 'k8s_container-name.00000000_pod-name_' + tag_parts[1] + '_' + tag_parts[-1] + '_01234567')}
	CONTAINER_ID_FULL ${record.fetch('CONTAINER_ID_FULL', '0123456789012345678901234567890123456789012345678901234567890123')}
  </record>
</filter>

<match project.**>
  @type rewrite_tag_filter
  rewriterule1 CONTAINER_NAME ^k8s_ kubernetes.journal.container.mux
  # mark non-kubernetes openshift-infra container logs as system logs
  rewriterule2 CONTAINER_NAME _openshift_ journal.container._openshift_
  # not kubernetes - assume a system log
  rewriterule3 _TRANSPORT .+ journal.system
</match>
